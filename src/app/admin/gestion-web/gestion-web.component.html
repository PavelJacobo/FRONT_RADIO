<div class="container">
    <div class="row ">
        <div class="col-md-12 text-center">
            <div class="btn-group btn-group-toggle" data-toggle="buttons">
                <label class="btn btn-secondary" (click)="conmutaTarget('noticias')">
                    <input type="radio" name="options"> Noticias
                </label>
                <label class="btn btn-secondary" (click)="conmutaTarget('programas')">
                    <input type="radio" name="options">Programas
                </label>
                <label class="btn btn-secondary" (click)="conmutaTarget('usuarios')">
                    <input type="radio" name="options"> Usuarios
                </label>
                <label class="btn btn-secondary" (click)="conmutaTarget('eventos')">
                    <input type="radio" name="options"> Reservas
                </label>
                <label class="btn btn-secondary" (click)="conmutaTarget('redonda')">
                    <input type="radio" name="options"> Redonda
                </label>
            </div>

        </div>
    </div>

    <div class="row patata" *ngIf="target">
        <ng-container [ngSwitch]=true class="col-md-12">
            <ng-template [ngSwitchCase]="target === noticias">

                <table class="table table-striped mt-3">
                    <thead>
                        <tr>
                            <th>Autor</th>
                            <th>resume</th>
                            <th>categoria</th>
                            <th>fecha</th>
                            <th>imagen</th>
                            <th class="text-danger">Borrar</th>
                            <th class="text-success">Editar</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let noticia of noticias; let i=index">
                            <td>{{ noticia.author?.nombre || "Anónimo" }}</td>
                            <td>{{ noticia.resume | slice:0:30}}...</td>
                            <td>{{ noticia.categoria }}</td>
                            <td>{{ noticia.date | date: 'dd/MM/yyyy'}}</td>
                            <td class="w70"><img [src]="noticia.img | imagen: 'noticia'"
                                    class="img img-fluid img-thumbnail" style="max-width: 100px;"></td>
                            <td><i (click)="eraseNoticia(noticia._id, i)"
                                    class="fas fa-trash-alt text-danger pointer"></i></td>
                            <td><i [routerLink]="['../detalle_noticia', noticia._id]"
                                    class="far fa-edit text-success pointer"></i></td>
                        </tr>
                    </tbody>
                </table>

            </ng-template>
            <ng-template [ngSwitchCase]="target === programas">
                <table class="table table-striped mt-3">
                    <thead>
                        <tr>
                            <th>imagen</th>
                            <th>nombre</th>
                            <th>colaboradores</th>
                            <th class="text-danger">Borrar</th>
                            <th class="text-success">Editar</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let programa of programas; let i=index">
                            <td class="w70"><img [src]="programa.img | imagen:'programa'"
                                    class="img img-fluid img-thumbnail" style="max-width: 100px;"></td>
                            <td>{{ programa.nombre }}</td>
                            <td>
                                <mat-chip-list>
                                    <ng-container *ngFor="let usuario of usuarios">
                                        <ng-container *ngFor="let colaborador of programa.colaboradores">
                                            <ng-container *ngIf="usuario._id === colaborador">
                                                <mat-chip>
                                                    <span class="pointer">{{ usuario.nombre }}</span>
                                                </mat-chip>
                                            </ng-container>
                                        </ng-container>
                                    </ng-container>
                                </mat-chip-list>
                            </td>
                            <td><i (click)="erasePrograma(programa._id, i)"
                                    class="fas fa-trash-alt text-danger pointer"></i></td>
                            <td><i [routerLink]="['../perfil_programa']" class="far fa-edit text-success pointer"></i>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </ng-template>
            <ng-template [ngSwitchCase]="target === usuarios">
                <table class="table table-striped mt-3">
                    <thead>
                        <tr>
                            <th>imagen</th>
                            <th>nombre</th>
                            <th>email</th>
                            <th>role</th>
                            <th>passwd</th>
                            <th class="text-danger">Borrar</th>
                            <th class="text-info">Actualizar</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let usuario of usuarios">
                            <td class="w40"><img [src]="usuario.img | imagen" class="img img-fluid img-thumbnail"
                                    style="max-width: 100px;"></td>
                            <td class="w40">{{ usuario.nombre }}</td>
                            <td class="w40">{{ usuario.email }}</td>
                            <td class="w40">
                                <mat-form-field>
                                    <mat-select [(value)]="usuario.role">
                                        <mat-option value="ADMIN_ROLE">ADMIN_ROLE</mat-option>
                                        <mat-option value="USER_ROLE">USER_ROLE</mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </td>
                            <td class="pointer">
                                <mat-form-field class="example-full-width" (click)="enablePwdInput($event)">
                                    <input disabled matInput [(value)]="usuario.password" #password type="password">
                                </mat-form-field>
                            </td>
                            <td><i (click)="eraseUser(usuario._id)" class="fas fa-trash-alt text-danger pointer"></i>
                            </td>
                            <td><i (click)="updateUser(usuario, password.value)"
                                    class="fas fa-save text-info pointer"></i></td>
                        </tr>
                    </tbody>
                </table>
            </ng-template>
            <ng-template [ngSwitchCase]="target === eventos">
                <table class="table table-striped mt-3">
                    <thead>
                        <tr>
                            <th>Usuario</th>
                            <th>Desde</th>
                            <th>Hasta</th>
                            <th class="text-danger">Borrar</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let evento of eventos; let i=index">
                            <td class="w40">{{ evento.title }}</td>
                            <td class="w40">{{ evento.start }}</td>
                            <td class="w40">{{ evento.end }}</td>
                            <td><i (click)="eraseEvento(evento._id, i)"
                                    class="fas fa-trash-alt text-danger pointer"></i></td>
                        </tr>
                    </tbody>
                </table>
            </ng-template>
            <ng-template [ngSwitchCase]="target === redonda">
                <div class="row w-100">
                    <table class="table table-striped mt-3">
                        <thead>
                            <tr>
                                <th>Subir PDF</th>

                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>
                                    <form>
                                        <div class="form-group">
                                            <label for="redonda">pdf de Redonda</label>
                                            <input type="file" class="form-control-file" id="redonda"
                                                (change)="seleccionImagen( $event.target.files[0] )" accept=".pdf">
                                        </div>
                                        <div class="form-group">
                                            <mat-form-field color="accent">
                                                <mat-label>Desde...</mat-label>
                                                <input [(ngModel)]="inicioAgenda" name="inicioAgenda" matInput
                                                    [matDatepicker]="picker1">
                                                <mat-datepicker-toggle matSuffix [for]="picker1">
                                                </mat-datepicker-toggle>
                                                <mat-datepicker #picker1></mat-datepicker>
                                            </mat-form-field>
                                        </div>
                                        <div class="form-group">
                                            <mat-form-field color="accent">
                                                <mat-label>Hasta...</mat-label>
                                                <input [(ngModel)]="finAgenda" name="finAgenda" matInput
                                                    [matDatepicker]="picker2">
                                                <mat-datepicker-toggle matSuffix [for]="picker2">
                                                </mat-datepicker-toggle>
                                                <mat-datepicker #picker2 color="primary"></mat-datepicker>
                                            </mat-form-field>

                                        </div>
                                        <button (click)="subirPdf()" class="btn btn-outline-secondary">Subir</button>
                                    </form>
                                </td>

                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="row w-100">
                    <div class="col-md-12">
                        <h4> Eventos de Redonda</h4>
                        <table class="table table-striped mt-3">
                            <thead>
                                <tr>
                                    <th>Titulo</th>
                                    <th>resume</th>
                                    <th>categoria</th>
                                    <th>fecha</th>
                                    <th>imagen</th>
                                    <th class="text-danger">Borrar</th>
                                    <th class="text-success">Editar</th>
                                </tr>
                            </thead>
                            <tbody>

                                <tr *ngFor="let noticia of noticias; let i=index">

                                    <td *ngIf="noticia.categoria == 'redonda'">{{ noticia.author?.nombre || "Anónimo" }}
                                    </td>
                                    <td *ngIf="noticia.categoria == 'redonda'">{{ noticia.resume | slice:0:30}}...</td>
                                    <td *ngIf="noticia.categoria == 'redonda'">{{ noticia.categoria }}</td>
                                    <td *ngIf="noticia.categoria == 'redonda'">{{ noticia.date | date: 'dd/MM/yyyy'}}
                                    </td>
                                    <td class="w70" *ngIf="noticia.categoria == 'redonda'"><img
                                            [src]="noticia.img | imagen: 'noticia'" class="img img-fluid img-thumbnail"
                                            style="max-width: 100px;"></td>
                                    <td *ngIf="noticia.categoria == 'redonda'"><i (click)="eraseNoticia(noticia._id, i)"
                                            class="fas fa-trash-alt text-danger pointer"></i></td>
                                    <td *ngIf="noticia.categoria == 'redonda'"><i
                                            [routerLink]="['../detalle_noticia', noticia._id]"
                                            class="far fa-edit text-success pointer"></i></td>

                                </tr>

                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <h4> Archivos Subidos </h4>
                        <table class="table table-striped mt-3">
                            <thead>
                                <tr>
                                    <th>Titulo</th>
                                    <th>resume</th>
                                    <th>categoria</th>
                                    <th>fecha</th>
                                    <th>imagen</th>
                                    <th class="text-danger">Borrar</th>
                                    <th class="text-success">Editar</th>
                                </tr>
                            </thead>
                            <tbody>

                                <tr *ngFor="let file of files; let i=index">


                                </tr>

                            </tbody>
                        </table>
                    </div>
                </div>
            </ng-template>
        </ng-container>

        <div *ngIf="target != redonda" class="col-12 col-md-12 w-100">
            <button (click)="cambiarDesde(-5)" class="btn btn-outline-secondary">Anteriores</button>
            <button (click)="cambiarDesde(5)" class="btn btn-outline-secondary">Siguientes</button>
        </div>


    </div>
    <div class="row patata" *ngIf="target === usuarios">
        <div *ngIf="target" class="col-md-12 w-100 text-center">
                <h3>Crear Usuario</h3>
            <div class="ml-auto mr-auto text-center">
                    <form class="mx-auto" ngNativeValidate [formGroup]="forma" (ngSubmit)="onSubmit()">
                            <div>
                                <mat-form-field>
                                    <input formControlName="username" required matInput placeholder="Usuario"
                                        type="text">
                                </mat-form-field>
                            </div>
                            <div>
                                <mat-form-field>
                                    <input formControlName="email" required matInput placeholder="Email" type="email">
                                </mat-form-field>
                            </div>
                            <div>
                                <mat-form-field>
                                    <input pattern='^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9]).{8,}$' formControlName="password1" required  matInput placeholder="Contraseña"
                                        type="password">
                                        <mat-hint>Utiliza mayúsculas y números, 8 carácteres mínimo</mat-hint>
                                </mat-form-field>
                            </div>
                            <div>
                                    <mat-form-field>
                                        <input pattern='^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9]).{8,}$' formControlName="password2" required matInput placeholder="Confirmar Contraseña"
                                            type="password">
                                    </mat-form-field>
                            </div>
                            <div>
                                    <mat-form-field>
                                            <mat-label>Rol</mat-label>
                                            <mat-select required formControlName="role">
                                              <mat-option *ngFor="let role of roles" [value]="role.value">
                                                {{role.viewValue}}
                                              </mat-option>
                                            </mat-select>                                          
                                    </mat-form-field>
                            </div>
                            <div>
                                    <button mat-raised-button color="primary">Crear Usuario</button>
                                    <button type="button" (click)="cancelar()" mat-raised-button color="warn">Cancelar</button>
                            </div>        
                        </form>
            </div>

        </div>
    </div>
</div>